name: Generate Property Detail Pages

on:
  push:
    paths:
      - 'data/properties/**/*.json'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install jq
        run: sudo apt-get update && sudo apt-get install -y jq

      - name: Generate detail pages
        run: |
          for json_file in data/properties/*/*.json; do
            [ -f "$json_file" ] || continue

            # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø¨Ø¯ÙˆÙ† Ø§Ù…ØªØ¯Ø§Ø¯
            filename=$(basename "$json_file" .json)
            category=$(basename $(dirname "$json_file"))
            output_file="data/properties/$category/$filename.html"

            # Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            title=$(jq -r '.title // "Ø¹Ù‚Ø§Ø± Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†"' "$json_file")
            price=$(jq -r '.price // "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"' "$json_file")
            area=$(jq -r '.area // "-"' "$json_file")
            description=$(jq -r '.description // "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ"' "$json_file")

            # ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙØ­Ø©
cat <<EOF > "$output_file"
---
layout: default
title: "$title"
description: "$description"
---

<main class="property-details">
  <div class="detail-section">
    <h1 class="section-title">$title</h1>
    <div class="price-tag">$price</div>
    <p><strong>Ø§Ù„Ù…Ø³Ø§Ø­Ø©:</strong> $area</p>
    <p><strong>Ø§Ù„ÙˆØµÙ:</strong> $description</p>

    <div style="margin-top: 2rem;">
      <a href="https://wa.me/201147758857?text=Ø£Ø±ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† $title" 
         class="whatsapp-btn" target="_blank">
        <i class="fab fa-whatsapp"></i> Ø§Ø³ØªÙØ³Ø± Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
      </a>
    </div>

    <div style="margin-top: 2rem;">
      <a href="/samsar-talabak/properties-filtered.html" class="back-btn">
        â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¹Ù‚Ø§Ø±Ø§Øª
      </a>
    </div>
  </div>
</main>
EOF
          done

      - name: Commit and push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ğŸ†• ØªÙˆÙ„ÙŠØ¯ ØµÙØ­Ø§Øª ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§"
          commit_user_name: GitHub Actions
          commit_user_email: actions@github.com
