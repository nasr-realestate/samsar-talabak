name: Generate HTML from JSON

on:
  push:
    paths:
      - 'data/properties/*.json'

jobs:
  generate-html:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Install jq
      run: sudo apt-get install jq

    - name: Generate HTML files
      run: |
        for json_file in data/properties/*.json; do
          # Extract the filename without extension
          filename=$(basename "$json_file" .json)

          # Extract fields using jq
          title=$(jq -r '.title' "$json_file")
          price=$(jq -r '.price' "$json_file")
          area=$(jq -r '.area' "$json_file")
          description=$(jq -r '.description' "$json_file")

          # Create HTML file with YAML front matter
          html_file="data/properties/${filename}.html"
          echo "---" > "$html_file"
          echo "layout: default" >> "$html_file"
          echo "title: $title" >> "$html_file"
          echo "description: $description" >> "$html_file"
          echo "---" >> "$html_file"
          echo "<!DOCTYPE html>" >> "$html_file"
          echo "<html>" >> "$html_file"
          echo "<head><title>$title</title></head>" >> "$html_file"
          echo "<body>" >> "$html_file"
          echo "<h1>$title</h1>" >> "$html_file"
          echo "<p><strong>Price:</strong> $price</p>" >> "$html_file"
          echo "<p><strong>Area:</strong> $area</p>" >> "$html_file"
          echo "<p><strong>Description:</strong> $description</p>" >> "$html_file"
          echo "<a href=\"https://wa.me/?text=${title}\" target=\"_blank\">Contact via WhatsApp</a>" >> "$html_file"
          echo "<a href=\"/offers/\" target=\"_blank\">Back to Offers</a>" >> "$html_file"
          echo "</body>" >> "$html_file"
          echo "</html>" >> "$html_file"
        done

    - name: Commit and push changes
      run: |
        git config --global user.name 'GitHub Actions'
        git config --global user.email 'actions@github.com'
        git add .
        git commit -m "Generated HTML files from JSON"
        git push
