name: Build Property Details Pages

on:
  push:
    paths:
      - 'data/properties/**/*.json'
  workflow_dispatch:

jobs:
  build-property-pages:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3

      - name: Install jq
        run: sudo apt-get install jq

      - name: Generate HTML for Each Property
        run: |
          for file in data/properties/*/*.json; do
            # ØªØ¬Ø§Ù‡Ù„ Ù…Ù„ÙØ§Øª Ø§Ù„ÙÙ‡Ø±Ø³Ø©
            if [[ "$file" == *"/index.json" ]]; then
              continue
            fi

            title=$(jq -r '.title' "$file")
            price=$(jq -r '.price' "$file")
            area=$(jq -r '.area' "$file")
            description=$(jq -r '.description' "$file")
            filename=$(basename "$file" .json)
            category=$(basename $(dirname "$file"))

            output="data/properties/$category/${filename}.html"

            cat <<EOF > "$output"
---
layout: default
title: $title
description: $description
---

<main class="property-details">
  <div class="detail-section">
    <h1 class="section-title">$title</h1>
    <div class="price-tag">$price</div>

    <p><strong>Ø§Ù„Ù…Ø³Ø§Ø­Ø©:</strong> $area</p>
    <p><strong>Ø§Ù„ÙˆØµÙ:</strong> $description</p>

    <div style="margin-top: 2rem;">
      <a href="https://wa.me/201147758857?text=Ø£Ø±ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† $title" class="whatsapp-btn" target="_blank">
        <i class="fab fa-whatsapp"></i> Ø§Ø³ØªÙØ³Ø± Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
      </a>
    </div>

    <div style="margin-top: 2rem;">
      <a href="/samsar-talabak/properties-filtered.html" class="back-btn">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</a>
    </div>
  </div>
</main>
EOF

          done

      - name: Commit Generated Pages
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add data/properties/**/*.html
          git commit -m "ğŸ”„ Auto-generated property pages from JSON"
          git push
