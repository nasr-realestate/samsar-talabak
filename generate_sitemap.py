import os
import glob

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹
BASE_URL = "https://aqarnasr.netlify.app"
OUTPUT_DIR = "_site"
SITEMAP_FILE = os.path.join(OUTPUT_DIR, "sitemap.xml")

def generate_xml():
    # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù†Ø´Ø± Ù…ÙˆØ¬ÙˆØ¯ (Ù„Ø£Ù†Ù†Ø§ Ø³Ù†Ø¹Ù…Ù„ Ø¨Ø¹Ø¯ Ø¨Ù†Ø§Ø¡ Ø¬ÙŠÙƒÙ„)
    if not os.path.exists(OUTPUT_DIR):
        os.makedirs(OUTPUT_DIR)

    print("ğŸš€ Starting Custom Sitemap Generation...")

    xml_content = '<?xml version="1.0" encoding="UTF-8"?>\n'
    # Ù‡Ø°Ø§ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø³ÙŠØ¤ÙƒØ¯ Ù„Ùƒ Ø£Ù† Ø§Ù„Ù…Ù„Ù Ù‡Ùˆ Ù…Ù„ÙÙ†Ø§ Ø§Ù„Ø¬Ø¯ÙŠØ¯
    xml_content += '<!-- GENERATED BY CUSTOM PYTHON SCRIPT -->\n'
    xml_content += '<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n'

    # 1. Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„Ø«Ø§Ø¨ØªØ©
    static_pages = ["", "properties-filtered", "requests-filtered", "add-your-property", "contact-us", "about-us"]
    for page in static_pages:
        xml_content += f'  <url><loc>{BASE_URL}/{page}</loc><priority>1.0</priority></url>\n'

    # 2. Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª (Properties)
    # Ù†Ø¨Ø­Ø« ÙÙŠ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠ
    for filepath in glob.glob("data/properties/*/*.json"):
        if "index.json" in filepath: continue
        
        filename = os.path.basename(filepath)
        clean_id = filename.replace('.json', '')
        category = os.path.basename(os.path.dirname(filepath))
        
        # Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ
        full_url = f"{BASE_URL}/details.html?id={clean_id}&amp;category={category}"
        xml_content += f'  <url><loc>{full_url}</loc><priority>0.8</priority></url>\n'

    # 3. Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Requests)
    for filepath in glob.glob("data/requests/*/*.json"):
        if "index.json" in filepath: continue
        
        filename = os.path.basename(filepath)
        clean_id = filename.replace('.json', '')
        category = os.path.basename(os.path.dirname(filepath))
        
        full_url = f"{BASE_URL}/request-details.html?id={clean_id}&amp;category={category}"
        xml_content += f'  <url><loc>{full_url}</loc><priority>0.6</priority></url>\n'

    xml_content += '</urlset>'
    
    # Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙŠ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
    with open(SITEMAP_FILE, "w", encoding="utf-8") as f:
        f.write(xml_content)
    
    print(f"âœ… Sitemap written to: {SITEMAP_FILE}")

if __name__ == "__main__":
    generate_xml()
