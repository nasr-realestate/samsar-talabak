---
layout: default
title: "عروض العقارات المميزة في مدينة نصر"
description: "استكشف أفضل العروض العقارية في مدينة نصر - شقق فاخرة، محلات تجارية، ومكاتب إدارية مع سمسار طلبك"
---

<style>
  /* ============= أنماط Jekyll المتوافقة ============= */
  :root {
    --primary: #1e3a5f;
    --secondary: #3498db;
    --accent: #00c853;
    --light: #f8f9fa;
    --dark: #212529;
    --success: #28a745;
    --warning: #ffc107;
    --error: #dc3545;
    --shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    --transition: all 0.3s ease;
    --radius: 12px;
    --header-height: 80px;
  }
  
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  
  body {
    background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
    color: #333;
    min-height: 100vh;
    overflow-x: hidden;
  }
  
  .page-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 15px;
  }
  
  /* تصميم الهيدر */
  .app-header {
    background: linear-gradient(to right, var(--primary), #142a4a);
    color: white;
    padding: 0 20px;
    height: var(--header-height);
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: var(--shadow);
  }
  
  .logo-container {
    display: flex;
    align-items: center;
    gap: 15px;
  }
  
  .logo {
    font-size: 1.8rem;
    font-weight: bold;
    background: linear-gradient(45deg, #00ff88, #00cc6a);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .logo-icon {
    font-size: 2.2rem;
    animation: pulse 2s infinite;
  }
  
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }
  
  .nav-btn {
    padding: 10px 25px;
    background: linear-gradient(45deg, var(--accent), #00a140);
    color: white;
    text-decoration: none;
    border-radius: 50px;
    font-weight: bold;
    font-size: 1rem;
    box-shadow: 0 5px 15px rgba(0, 200, 83, 0.3);
    transition: var(--transition);
    border: none;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  
  .nav-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0, 200, 83, 0.4);
  }
  
  /* رسالة الترحيب */
  #welcome-message {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    border: 2px solid var(--accent);
    border-radius: var(--radius);
    padding: 25px;
    margin: 30px auto;
    max-width: 800px;
    text-align: center;
    box-shadow: var(--shadow);
    position: relative;
    overflow: hidden;
    animation: slideInUp 0.8s ease-out;
    display: none;
  }
  
  @keyframes slideInUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .welcome-title {
    color: var(--primary);
    font-size: 2.2rem;
    margin-bottom: 15px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
  }
  
  .welcome-title span {
    background: linear-gradient(45deg, var(--accent), #00a140);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  /* أزرار الفلترة */
  .filter-container {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
    margin: 30px 0;
    padding: 15px;
    position: sticky;
    top: calc(var(--header-height) + 10px);
    z-index: 100;
    transition: var(--transition);
    background: white;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
  }
  
  .filter-container.scrolled {
    max-width: 90%;
    margin: 15px auto;
  }
  
  .filter-btn {
    padding: 12px 24px;
    background: white;
    color: var(--dark);
    border: 2px solid #e0e0e0;
    border-radius: 50px;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 8px;
    position: relative;
    overflow: hidden;
  }
  
  .filter-btn:hover {
    transform: translateY(-3px);
    border-color: var(--accent);
    box-shadow: 0 5px 15px rgba(0, 200, 83, 0.1);
  }
  
  .filter-btn.active {
    background: linear-gradient(45deg, var(--accent), #00a140);
    color: white;
    border-color: var(--accent);
    box-shadow: 0 5px 15px rgba(0, 200, 83, 0.2);
  }
  
  .date-filter-wrapper {
    display: flex;
    align-items: center;
    gap: 10px;
    background: white;
    padding: 8px 15px;
    border-radius: 50px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  }
  
  .date-filter-label {
    font-weight: 500;
    color: var(--dark);
  }
  
  .date-filter-select {
    padding: 8px 15px;
    border-radius: 50px;
    border: 1px solid #ddd;
    background: white;
    font-weight: 500;
    cursor: pointer;
    transition: var(--transition);
  }
  
  .date-filter-select:hover {
    border-color: var(--accent);
  }
  
  /* حاوية العقارات */
  .properties-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 30px;
    padding: 20px 0;
  }
  
  .property-card {
    background: white;
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: var(--shadow);
    transition: var(--transition);
    position: relative;
    display: flex;
    flex-direction: column;
    height: 100%;
  }
  
  .property-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
  }
  
  .property-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    background: linear-gradient(to right, var(--primary), #142a4a);
    color: white;
  }
  
  .property-brand {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .property-logo {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid white;
  }
  
  .property-category-badge {
    background: var(--accent);
    padding: 3px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
  }
  
  .property-actions {
    display: flex;
    gap: 10px;
  }
  
  .favorite-btn, .share-btn {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: var(--transition);
    color: white;
    font-size: 1.2rem;
  }
  
  .favorite-btn:hover, .share-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.1);
  }
  
  .property-content {
    padding: 20px;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }
  
  .property-title {
    font-size: 1.4rem;
    color: var(--primary);
    margin-bottom: 15px;
    line-height: 1.4;
  }
  
  .property-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
  }
  
  .property-detail {
    display: flex;
    flex-direction: column;
    gap: 5px;
  }
  
  .detail-icon {
    font-size: 1.4rem;
    color: var(--accent);
  }
  
  .detail-label {
    font-size: 0.85rem;
    color: #666;
  }
  
  .detail-value {
    font-weight: 600;
    color: var(--dark);
  }
  
  .price-highlight {
    color: var(--accent);
    font-size: 1.1rem;
    font-weight: 700;
  }
  
  .property-description {
    margin-bottom: 20px;
    color: #555;
    line-height: 1.6;
    flex-grow: 1;
  }
  
  .property-footer {
    margin-top: auto;
    padding-top: 15px;
    border-top: 1px solid #eee;
  }
  
  .view-details-btn {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 20px;
    background: linear-gradient(45deg, var(--primary), #142a4a);
    color: white;
    text-decoration: none;
    border-radius: var(--radius);
    font-weight: 600;
    transition: var(--transition);
  }
  
  .view-details-btn:hover {
    background: linear-gradient(45deg, #1a3a5f, #1a2530);
    transform: translateX(-5px);
  }
  
  .property-stats {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
    color: #666;
    font-size: 0.9rem;
  }
  
  .stat-item {
    display: flex;
    align-items: center;
    gap: 5px;
  }
  
  /* الحالات المختلفة */
  .loading-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 50px 20px;
    grid-column: 1 / -1;
  }
  
  .loading-spinner {
    width: 60px;
    height: 60px;
    border: 5px solid rgba(0, 200, 83, 0.2);
    border-top: 5px solid var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 20px;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .empty-state, .error-state {
    grid-column: 1 / -1;
    text-align: center;
    padding: 50px 20px;
    background: white;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
  }
  
  .empty-icon, .error-icon {
    font-size: 4rem;
    margin-bottom: 20px;
    color: var(--accent);
  }
  
  .refresh-btn, .retry-btn, .contact-btn {
    padding: 10px 25px;
    margin: 15px 10px;
    border-radius: 50px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  
  .refresh-btn, .retry-btn {
    background: var(--accent);
    color: white;
    border: none;
  }
  
  .contact-btn {
    background: var(--primary);
    color: white;
    border: none;
  }
  
  /* تصميم متجاوب */
  @media (max-width: 768px) {
    .app-header {
      flex-direction: column;
      height: auto;
      padding: 15px;
      gap: 15px;
    }
    
    .filter-container {
      position: static;
      top: unset;
    }
    
    .properties-grid {
      grid-template-columns: 1fr;
    }
    
    .logo {
      font-size: 1.5rem;
    }
    
    .welcome-title {
      font-size: 1.8rem;
    }
  }
  
  @media (max-width: 480px) {
    .filter-container {
      flex-direction: column;
    }
    
    .date-filter-wrapper {
      width: 100%;
      justify-content: center;
    }
  }
</style>

<div class="page-container">
  <!-- الهيدر -->
  <header class="app-header">
    <div class="logo-container">
      <div class="logo">
        <span class="logo-icon">🏢</span>
        <span>سمسار طلبك الذكي</span>
      </div>
    </div>
    <a href="/samsar-talabak/add-your-property.html" class="nav-btn">
      <span>✨</span>
      <span>أضف عقارك</span>
    </a>
  </header>

  <!-- رسالة ترحيب -->
  <div id="welcome-message" class="welcome-message">
    <h2 class="welcome-title">
      <span>🎉</span>
      <span>مرحباً بك في <span>سمسار طلبك</span></span>
    </h2>
    <p style="font-size: 1.2rem; color: #555; line-height: 1.6; margin-bottom: 20px;">
      🏠 استكشف الآن أحدث وأفضل العروض العقارية في مدينة نصر<br>
      💎 شقق فاخرة • محلات تجارية • مكاتب إدارية • وأكثر بكثير!
    </p>
    <div style="margin-top: 1rem;">
      <span style="color: var(--accent); font-weight: bold; font-size: 1.1rem;">⏰ عروض محدودة الوقت</span>
    </div>
  </div>

  <!-- أزرار التصنيفات -->
  <div id="filter-buttons" class="filter-container">
    <!-- سيتم ملؤها بواسطة الجافاسكربت -->
  </div>

  <!-- حاوية العقارات -->
  <div id="properties-container" class="properties-grid">
    <!-- حالة التحميل -->
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <h3 style="color: var(--primary); margin-bottom: 10px;">جاري تحميل العروض العقارية</h3>
      <p style="color: #666;">يرجى الانتظار قليلاً...</p>
    </div>
  </div>
</div>

<script>
  class EnhancedPropertyDisplay {
    constructor() {
      this.container = null;
      this.filterContainer = null;
      this.welcomeBox = null;
      this.currentCategory = null;
      this.currentDateFilter = 'latest';
      this.propertiesCache = new Map();
      this.isLoading = false;
      
      this.config = {
        animationDuration: 300,
        cacheExpiry: 5 * 60 * 1000,
        loadingDelay: 800,
        welcomeDisplayTime: 7000,
        maxRetries: 3,
        retryDelay: 1000
      };

      this.categories = {
        "apartments": { label: "🏠 شقق للبيع", icon: "🏠", color: "#00ff88", description: "شقق سكنية فاخرة" },
        "apartments-rent": { label: "🏡 شقق للإيجار", icon: "🏡", color: "#00ccff", description: "شقق للإيجار الشهري" },
        "shops": { label: "🏪 محلات تجارية", icon: "🏪", color: "#ff6b35", description: "محلات ومساحات تجارية" },
        "offices": { label: "🏢 مكاتب إدارية", icon: "🏢", color: "#8b5cf6", description: "مكاتب ومساحات عمل" },
        "admin-hq": { label: "🏛️ مقرات إدارية", icon: "🏛️", color: "#f59e0b", description: "مقرات ومباني إدارية" }
      };

      this.init();
    }

    async init() {
      try {
        await this.waitForDOM();
        this.setupElements();
        this.createFilterUI();
        this.setupEventListeners();
        this.handleWelcomeMessage();
        this.loadDefaultCategory();
      } catch (error) {
        console.error('خطأ حرج في تهيئة التطبيق:', error);
        this.showErrorMessage('حدث خطأ حرج في تحميل التطبيق');
      }
    }
    
    // ===================================================================
    // تحميل وعرض البيانات (المنطق الأساسي المصحح والمحصن)
    // ===================================================================

    async handleCategoryChange(category, button) {
      if (this.isLoading) return;
      if (this.currentCategory === category) {
          // إذا نقر المستخدم على نفس الفئة مرة أخرى، قم بتحديثها
          await this.refreshCurrentCategory();
          return;
      }
      
      this.isLoading = true;
      this.updateActiveButton(button);
      this.currentCategory = category;
      
      this.showLoadingState();
      try {
        const cachedData = this.getCachedData(category);
        let dataToDisplay;
        if (cachedData) {
          console.log(`[DEBUG] 🟢 عرض البيانات من الكاش للفئة: ${category}`);
          dataToDisplay = cachedData;
        } else {
          console.log(`[DEBUG] 🟡 جلب البيانات من الشبكة للفئة: ${category}`);
          dataToDisplay = await this.fetchCategoryData(category);
          this.setCachedData(category, dataToDisplay);
        }
        
        await this.displayProperties(dataToDisplay, category);
        localStorage.setItem('lastCategory', category);

      } catch (error) {
        console.error(`[DEBUG] 🔴 فشل نهائي في تحميل الفئة ${category}:`, error);
        this.showErrorMessage(`فشل في جلب بيانات "${this.categories[category].label}". قد يكون هناك مشكلة في الشبكة أو المسار.`);
      } finally {
        this.isLoading = false;
      }
    }

    async fetchCategoryData(category) {
      let retries = 0;
      const indexPath = `/samsar-talabak/data/properties/${category}/index.json`;
      console.log(`[DEBUG] محاولة جلب ملف الفهرس: ${indexPath}`);

      while (retries < this.config.maxRetries) {
        try {
          const indexResponse = await fetch(indexPath);
          if (!indexResponse.ok) {
            throw new Error(`فشل جلب الفهرس: ${indexResponse.status} ${indexResponse.statusText}`);
          }
          
          const files = await indexResponse.json();
          console.log(`[DEBUG] تم العثور على ${files.length} ملف في الفهرس.`);
          if (!Array.isArray(files) || files.length === 0) return [];

          const propertyPromises = files.map(filename => this.fetchPropertyData(category, filename));
          const results = await Promise.allSettled(propertyPromises);
          
          const fulfilledProperties = results
            .filter(result => result.status === 'fulfilled' && result.value !== null)
            .map(result => result.value);
          
          console.log(`[DEBUG] تم تحميل ${fulfilledProperties.length} عقار بنجاح.`);
          return fulfilledProperties;

        } catch (error) {
          retries++;
          console.warn(`[DEBUG] المحاولة #${retries} فشلت:`, error.message);
          if (retries >= this.config.maxRetries) {
            console.error(`[DEBUG] كل المحاولات فشلت لجلب: ${indexPath}`);
            throw error;
          }
          await this.delay(this.config.retryDelay * retries);
        }
      }
      return [];
    }

    async fetchPropertyData(category, filename) {
      const propertyPath = `/samsar-talabak/data/properties/${category}/${filename}`;
      try {
        const response = await fetch(propertyPath);
        if (!response.ok) {
          throw new Error(`فشل جلب العقار: ${response.status}`);
        }
        const data = await response.json();
        return { ...data, filename, category };
      } catch (error) {
        console.warn(`[DEBUG] فشل في تحميل أو تحليل ${propertyPath}:`, error);
        return null;
      }
    }

    async refreshCurrentCategory() {
      if (!this.currentCategory || this.isLoading) return;
      console.log(`[DEBUG] 🔄 تحديث الفئة الحالية: ${this.currentCategory}`);
      this.clearCachedData(this.currentCategory);
      await this.handleCategoryChange(this.currentCategory, this.filterContainer.querySelector(`[data-category="${this.currentCategory}"]`));
      this.showNotification('تم تحديث البيانات بنجاح', 'success');
    }

    // ... (بقية الدوال من الكود الأصلي مع تعديلات طفيفة)
    // سيتم تضمينها كاملة في التنفيذ

    waitForDOM() { return new Promise(r => document.readyState === 'loading' ? document.addEventListener('DOMContentLoaded', r) : r()); }
    setupElements() {
      this.container = document.getElementById("properties-container");
      this.filterContainer = document.getElementById("filter-buttons");
      this.welcomeBox = document.getElementById("welcome-message");
      if (!this.container || !this.filterContainer) throw new Error('العناصر الأساسية غير موجودة');
    }
    
    createFilterUI() { 
      this.createCategoryButtons(); 
      this.createDateFilter(); 
    }
    
    createCategoryButtons() { 
      Object.entries(this.categories).forEach(([k, c], i) => {
        this.filterContainer.appendChild(this.createFilterButton(k, c, i));
      }); 
    }
    
    createFilterButton(key, category, index) {
      const button = document.createElement("button");
      button.textContent = category.label;
      button.dataset.category = key;
      button.className = "filter-btn";
      button.title = category.description;
      button.style.animationDelay = `${index * 100}ms`;
      button.addEventListener("click", (e) => { 
        e.preventDefault(); 
        this.handleCategoryChange(key, button); 
      });
      return button;
    }
    
    createDateFilter() {
      const filterWrapper = document.createElement('div');
      filterWrapper.className = 'date-filter-wrapper';
      filterWrapper.innerHTML = `
        <span class="date-filter-label">📅 الفرز حسب:</span>
        <select id="date-filter" class="date-filter-select">
          <option value="latest">الأحدث أولاً</option>
          <option value="all">كل الأوقات</option>
          <option value="last_week">آخر أسبوع</option>
          <option value="last_month">آخر شهر</option>
        </select>
      `;
      this.filterContainer.appendChild(filterWrapper);
      document.getElementById('date-filter').addEventListener('change', (e) => 
        this.handleDateFilterChange(e.target.value)
      );
    }
    
    async handleDateFilterChange(newFilterValue) {
      this.currentDateFilter = newFilterValue;
      if (this.currentCategory) {
          const cachedData = this.getCachedData(this.currentCategory);
          if (cachedData) await this.displayProperties(cachedData, this.currentCategory);
      }
    }
    
    updateActiveButton(activeButton) {
      this.filterContainer.querySelectorAll('.filter-btn').forEach(btn => { 
        btn.classList.remove('active'); 
      });
      activeButton.classList.add('active');
    }
    
    showLoadingState() { 
      this.container.innerHTML = `
        <div class="loading-container">
          <div class="loading-spinner"></div>
          <h3>جاري تحميل العروض العقارية</h3>
          <p>يرجى الانتظار قليلاً...</p>
        </div>
      `; 
    }
    
    applyFiltersAndSorting(properties) {
      let processedProperties = [...properties];
      const now = new Date();
      const oneDay = 1000 * 60 * 60 * 24;
      if (this.currentDateFilter === 'last_week' || this.currentDateFilter === 'last_month') {
        const daysToFilter = this.currentDateFilter === 'last_week' ? 7 : 30;
        processedProperties = processedProperties.filter(p => {
          if (!p.date) return false;
          try { return (now - new Date(p.date)) / oneDay <= daysToFilter; } catch { return false; }
        });
      }
      if (this.currentDateFilter !== 'all') {
        processedProperties.sort((a, b) => { 
          try { return new Date(b.date) - new Date(a.date); } catch { return 0; } 
        });
      }
      return processedProperties;
    }
    
    async displayProperties(properties, category) {
      if (!Array.isArray(properties)) { 
        this.showErrorMessage('بيانات غير صحيحة'); 
        return; 
      }
      
      const filteredProperties = this.applyFiltersAndSorting(properties);
      if (filteredProperties.length === 0) { 
        this.showEmptyState(category, properties.length > 0); 
        return; 
      }
      
      this.container.innerHTML = '';
      const fragment = document.createDocumentFragment();
      
      filteredProperties.forEach(prop => {
        fragment.appendChild(this.createPropertyCard(prop, category));
      });
      
      this.container.appendChild(fragment);
      this.setupCardInteractions();
    }
    
    createPropertyCard(property, category) {
      const categoryInfo = this.categories[category];
      const card = document.createElement("div");
      card.className = `property-card`;
      card.dataset.filename = property.filename;
      card.dataset.category = category;
      
      const detailPage = `/samsar-talabak/details.html?category=${category}&file=${encodeURIComponent(property.filename)}`;
      const descriptionText = property.summary || property.description || "لا يوجد وصف متوفر";
      
      card.innerHTML = `
        <div class="property-header">
          <div class="property-brand">
            <img src="https://i.postimg.cc/Vk8Nn1xZ/me.jpg" alt="شعار سمسار طلبك" class="property-logo">
            <div>
              <strong>سمسار طلبك</strong>
              <div class="property-category-badge">${categoryInfo.icon} ${categoryInfo.label}</div>
            </div>
          </div>
          <div class="property-actions">
            <button class="favorite-btn" title="إضافة للمفضلة">❤️</button>
            <button class="share-btn" title="مشاركة">📤</button>
          </div>
        </div>
        
        <div class="property-content">
          <h2 class="property-title">${this.escapeHtml(property.title)}</h2>
          
          <div class="property-details">
            <div class="property-detail">
              <span class="detail-icon">💰</span>
              <div>
                <div class="detail-label">السعر:</div>
                <div class="detail-value price-highlight">${this.escapeHtml(property.price || "غير محدد")}</div>
              </div>
            </div>
            
            <div class="property-detail">
              <span class="detail-icon">📏</span>
              <div>
                <div class="detail-label">المساحة:</div>
                <div class="detail-value">${this.escapeHtml(property.area || "غير محدد")}</div>
              </div>
            </div>
            
            <div class="property-detail">
              <span class="detail-icon">📅</span>
              <div>
                <div class="detail-label">تاريخ الإضافة:</div>
                <div class="detail-value">${this.escapeHtml(property.date || "غير متوفر")}</div>
              </div>
            </div>
            
            ${property.location ? `
            <div class="property-detail">
              <span class="detail-icon">📍</span>
              <div>
                <div class="detail-label">الموقع:</div>
                <div class="detail-value">${this.escapeHtml(property.location)}</div>
              </div>
            </div>` : ''}
          </div>
          
          <div class="property-description">
            <p>${this.escapeHtml(descriptionText)}</p>
          </div>
          
          <div class="property-footer">
            <a href="${detailPage}" class="view-details-btn">
              <span class="btn-icon">👁️</span>
              <span class="btn-text">عرض التفاصيل الكاملة</span>
              <span class="btn-arrow">←</span>
            </a>
            
            <div class="property-stats">
              <span class="stat-item">
                <span class="stat-icon">👀</span>
                <span class="stat-value">${Math.floor(Math.random() * 100) + 10}</span>
              </span>
              <span class="stat-item">
                <span class="stat-icon">⏰</span>
                <span class="stat-value">${this.getTimeAgo(property.date)}</span>
              </span>
            </div>
          </div>
        </div>
      `;
      
      this.setupCardEvents(card, property);
      return card;
    }
    
    setupCardEvents(card, property) {
      card.querySelector('.favorite-btn').addEventListener('click', (e) => { 
        e.stopPropagation(); 
        this.toggleFavorite(card, property); 
      });
      
      card.querySelector('.share-btn').addEventListener('click', (e) => { 
        e.stopPropagation(); 
        this.shareProperty(property); 
      });
    }
    
    showEmptyState(category, isAfterFilter = false) {
      const c = this.categories[category];
      let message = `<p>لم يتم العثور على عقارات في فئة "${c.label}"</p>`;
      
      if (isAfterFilter) {
        message = `<p>لا توجد نتائج تطابق معايير الفرز الحالية.<br>جرب اختيار "كل الأوقات".</p>`;
      }
      
      this.container.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">${isAfterFilter ? '🧐' : c.icon}</div>
          <h3>${isAfterFilter ? 'لا توجد نتائج مطابقة' : 'لا توجد عروض حالياً'}</h3>
          ${message}
          <button class="refresh-btn" onclick="location.reload()">🔄 تحديث الصفحة</button>
        </div>
      `;
    }
    
    showErrorMessage(message) {
      this.container.innerHTML = `
        <div class="error-state">
          <div class="error-icon">⚠️</div>
          <h3>حدث خطأ</h3>
          <p>${message}</p>
          <div class="error-actions">
            <button class="retry-btn" onclick="location.reload()">🔄 إعادة المحاولة</button>
            <button class="contact-btn" onclick="window.open('tel:+201234567890')">📞 اتصل بنا</button>
          </div>
        </div>
      `;
    }
    
    handleWelcomeMessage() { 
      if (this.welcomeBox && !localStorage.getItem("welcomeShown")) {
        this.welcomeBox.style.display = 'block';
        localStorage.setItem("welcomeShown", "true");
        setTimeout(() => {
          this.welcomeBox.style.opacity = '0';
          setTimeout(() => {
            this.welcomeBox.style.display = 'none';
          }, 500);
        }, this.config.welcomeDisplayTime);
      }
    }
    
    loadDefaultCategory() {
      const savedCategory = localStorage.getItem('lastCategory');
      const defaultCategory = savedCategory && this.categories[savedCategory] ? savedCategory : Object.keys(this.categories)[0];
      const defaultButton = this.filterContainer.querySelector(`[data-category="${defaultCategory}"]`);
      if (defaultButton) defaultButton.click();
    }
    
    // ... (بقية الدوال المساعدة)
    
    escapeHtml(text) {
      return text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }
    
    getTimeAgo(dateString) {
      if (!dateString) return "غير معروف";
      
      try {
        const date = new Date(dateString);
        const now = new Date();
        const diff = Math.floor((now - date) / 1000);
        
        if (diff < 60) return "الآن";
        if (diff < 3600) return `${Math.floor(diff / 60)} دقائق`;
        if (diff < 86400) return `${Math.floor(diff / 3600)} ساعات`;
        if (diff < 2592000) return `${Math.floor(diff / 86400)} أيام`;
        if (diff < 31536000) return `${Math.floor(diff / 2592000)} شهور`;
        return `${Math.floor(diff / 31536000)} سنوات`;
      } catch {
        return "غير معروف";
      }
    }
    
    delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    getCachedData(category) {
      const cached = this.propertiesCache.get(category);
      if (cached && Date.now() - cached.timestamp < this.config.cacheExpiry) {
        return cached.data;
      }
      return null;
    }
    
    setCachedData(category, data) {
      this.propertiesCache.set(category, {
        data: data,
        timestamp: Date.now()
      });
    }
    
    clearCachedData(category) {
      this.propertiesCache.delete(category);
    }
  }

  // بدء التطبيق بعد تحميل الصفحة
  document.addEventListener('DOMContentLoaded', () => {
    const propertyDisplay = new EnhancedPropertyDisplay();
    window.propertyDisplay = propertyDisplay; // لجعل الكائن متاحًا للاستدعاء من الكونسول
  });
</script>
